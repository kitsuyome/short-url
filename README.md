# URL Shortener Service

Это сервис для сокращения длинных URL, получения статистики по ним и управления ссылками. Сервис позволяет:
- Создавать короткие ссылки (с возможностью задать кастомный alias).
- Перенаправлять запросы с коротких ссылок на оригинальные URL.
- Получать статистику: дата создания, количество переходов, дата последнего использования.
- Обновлять и удалять ссылки (только для зарегистрированных пользователей).
- Поиск ссылки по оригинальному URL.
- Устанавливать время жизни ссылки (после которого ссылка автоматически удаляется).
- Группировать ссылки по проектам (если требуется).
- Создавать короткие ссылки для незарегистрированных пользователей.
- Регистрация пользователей для управления ссылками.

## Структура API

### Ссылки (Links)
- `POST /links/shorten`  
  Создает короткую ссылку. Принимает JSON с полями:
  - `original_url` (обязательное поле)
  - `custom_alias` (опционально, если пользователь хочет задать свой alias)
  - `expires_at` (опционально, в формате ISO 8601 с точностью до минуты)

- `GET /links/{short_code}`  
  Перенаправляет на оригинальный URL, увеличивая счетчик переходов и обновляя дату последнего использования.

- `PUT /links/{short_code}`  
  Обновляет оригинальный URL (только для автора ссылки, если пользователь залогинен).

- `DELETE /links/{short_code}`  
  Удаляет связь короткой и оригинальной ссылки (только для автора ссылки).

- `GET /links/{short_code}/stats`  
  Возвращает статистику по ссылке: оригинальный URL, дату создания, количество переходов, дату последнего использования.

- `GET /links/search?original_url={url}`  
  Ищет короткую ссылку по оригинальному URL.

### Пользователи (Users)
- `POST /users/register`  
  Регистрация пользователя. Принимает username и password.

- `POST /users/login`  
  Авторизация. Принимает username и password, возвращает JWT-токен.

## Запуск

1. Убедитесь, что на машине установлены Docker и Docker Compose.
2. Склонируйте репозиторий.
3. Отредактируйте переменные окружения (при необходимости) в файле `docker-compose.yml` или создайте `.env` файл.
4. Соберите и запустите контейнеры:
   ```bash
   docker-compose up --build
   ```

## Описание БД

**Таблица users**
id: Уникальный идентификатор пользователя.
username: Имя пользователя (уникальное).
hashed_password: Хэш пароля.
created_at: Дата регистрации.

**Таблица links**
id: Уникальный идентификатор ссылки.
original_url: Исходный длинный URL.
short_code: Сгенерированный короткий код или кастомный alias.
custom_alias: Опциональное значение для кастомизации.
created_at: Дата создания ссылки.
expires_at: Дата истечения срока действия (опционально).
last_accessed_at: Дата последнего перехода по ссылке.
redirect_count: Количество переходов.
owner_id: Идентификатор пользователя, создавшего ссылку (если пользователь зарегистрирован).
project: Название проекта (опционально), для группировки ссылок.

**Таблица expired_links**
id: Уникальный идентификатор записи.
link_id: ID ссылки из таблицы links.
original_url: Исходный URL.
short_code: Короткий код.
owner_id: ID пользователя-владельца (если есть).
project: Название проекта (если указано).
deleted_at: Дата удаления ссылки.